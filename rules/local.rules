cat /etc/snort/rules/local.rules

# ================= FINAL CUSTOM RULESET =================

# ===== SQL Injection Detection (Top Priority) =====
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] SQL Injection Attempt Detected (OR 1=1)"; flow:to_server,established; content:"id=%27%20OR%201=1--"; sid:2000001; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] SQL Injection Attempt Detected (Encoded OR 1=1)"; flow:to_server,established; content:"id=%27+OR+1%3D1--"; sid:2000002; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] SQL Injection Attempt Detected (UNION SELECT)"; flow:to_server,established; content:"UNION+SELECT"; sid:2000003; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] SQL Injection Attempt Detected (Tautology a=a)"; flow:to_server,established; content:"%22a%22=%22a%22"; sid:2000004; rev:1;)

# ===== Metasploit Detection =====
alert tcp any any -> $HOME_NET any (msg:"[ALERT] Metasploit Exploit Detected (Header)"; flow:to_server,established; content:"Metasploit"; sid:2000100; rev:2;)
alert tcp any any -> $HOME_NET any (msg:"[ALERT] Metasploit Exploit Detected (Meterpreter User-Agent)"; flow:to_server,established; content:"Meterpreter"; sid:2000101; rev:2;)

# ===== Reconnaissance & Scans =====
alert tcp any any -> $HOME_NET any (msg:"[ALERT] Nmap SYN Scan Detected"; flags:S; sid:1000001; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 1:1024 (msg:"[ALERT] Port Scan Detected"; flags:S; sid:1000013; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET any (msg:"[ALERT] Nmap XMAS Scan Detected"; flags:FPU; sid:1000022; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET any (msg:"[ALERT] Aggressive Port Scan Detected"; flags:S; sid:1000024; rev:4; detection_filter:track by_src, count 5, seconds 5;)

# ===== Authentication / Brute Force =====
alert tcp any any -> $HOME_NET 22 (msg:"[ALERT] SSH Connection Attempt Detected"; sid:1000002; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET [21,22,80,445] (msg:"[ALERT] Brute Force Attempt Detected"; sid:1000014; rev:3; detection_filter:track by_src, count 5, seconds 5;)

# ===== Common Services Access =====
alert icmp any any -> $HOME_NET any (msg:"[ALERT] ICMP Echo Request Detected"; itype:8; sid:1000003; rev:5; detection_filter:track by_src, count 5, seconds 10;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] HTTP Access Attempt Detected"; sid:1000004; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 443 (msg:"[ALERT] HTTPS Access Attempt Detected"; sid:1000005; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 21 (msg:"[ALERT] FTP Connection Attempt Detected"; sid:1000006; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 23 (msg:"[ALERT] TELNET Connection Attempt Detected"; sid:1000007; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 3389 (msg:"[ALERT] RDP Connection Attempt Detected"; sid:1000008; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 3306 (msg:"[ALERT] MySQL Access Attempt Detected"; sid:1000009; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 25 (msg:"[ALERT] SMTP Mail Attempt Detected"; sid:1000010; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert udp any any -> $HOME_NET 53 (msg:"[ALERT] DNS Query Detected"; sid:1000011; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert tcp any any -> $HOME_NET 445 (msg:"[ALERT] SMB File Sharing Attempt Detected"; flow:to_server; flags:S; sid:1000012; rev:5; detection_filter:track by_src, count 3, seconds 5;)
# ===== Malware Detection ====
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] EXE File Request Detected"; flow:to_server,established; content:".exe"; sid:2000301; rev:4;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] EXE File Download Detected (MIME Header)"; flow:to_client,established; http_header; content:"application/x-msdos-program"; sid:400001; rev:1;)

alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] EXE File Download Detected (MZ Payload)"; flow:to_client,established; file_data; content:"MZ"; sid:400002; rev:1;)

# ===== Application Scans =====
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] Nikto Scan Detected"; flow:to_server,established; content:"Nikto"; sid:1000056; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] Dirb Scan Detected"; flow:to_server,established; content:"dirb"; sid:1000057; rev:1;)

# ===== Web Exploits =====
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] XSS Attempt Detected (<script>)"; flow:to_server,established; content:"<script>"; sid:1000300; rev:4;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] XSS Attempt Detected (alert)"; flow:to_server,established; content:"script>alert"; sid:1000301; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] XSS Attempt Detected (Encoded)"; flow:to_server,established; content:"%3Cscript%3E"; sid:1000302; rev:1;)

# ===== Webshell Uploads =====
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] Possible Webshell Upload Detected (.php)"; flow:to_server,established; content:".php"; sid:1000400; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] Possible Webshell Upload Detected (.asp)"; flow:to_server,established; content:".asp"; sid:1000401; rev:1;)
alert tcp any any -> $HOME_NET 80 (msg:"[ALERT] Possible Webshell Upload Detected (.jsp)"; flow:to_server,established; content:".jsp"; sid:1000402; rev:1;)

# ===== DoS Detection =====
alert icmp any any -> $HOME_NET any (msg:"[ALERT] Possible DoS/DDoS Attack Detected"; itype:8; sid:1000020; rev:3; detection_filter:track by_src, count 5, seconds 5;)
alert udp any any -> $HOME_NET ![53,443] (msg:"[ALERT] UDP Packet Detected"; sid:1000015; rev:5; detection_filter:track by_src, count 5, seconds 5;)
